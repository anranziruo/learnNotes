### 内容

### 反向代理
```
反向代理服务器可以隐藏源服务器的存在和特征。它充当互联网云和web服务器之间的中间层。这对于安全方面来说是很好的，特别是当您使用web托管服务时。
```

### Master和work
```
Master进程：读取及评估配置和维持
Worker进程：处理请求
有少个cpu的内核就配置多少个work_process
```

### 如何处理请求
```
nginx仅测试请求的标头字段“Host”，以确定请求应路由到哪个服务器。如果其值与任何服务器名称都不匹配，或者请求根本不包含此标头字段，则nginx会将请求路由到此端口的默认服务器。在上面的配置中，默认服务器是第一个 - 这是nginx的标准默认行为。它也可以default_server使用listen指令中的参数明确设置哪个服务器应该是默认的：
```

### ngnix和apache的区别
```
一:ngnix
1.抗并发，nginx以epollandkqueue作为开发模型，处理请求是异步非阻塞的，负载能力比apache高很多，
2.而apache则是阻塞型的。在高并发下nginx能保持低资源低消耗高性能，而apache在PHP处理慢或者前端压力很大的情况下，很容易出现进程数飙升，从而拒绝服务的现象。 
3、nginx在开启时，会生成一个master进程，然后，master进程会fork多个worker子进程，最后每个用户的请求由worker的子线程处理。 
4、可以配置nginx的upstream实现nginx的反向代理。 
5、nginx作为负载均衡服务器，支持7层负载均衡。 
6、nginx处理静态文件好，静态处理性能比apache高三倍以上。
7、支持高并发连接，每秒最多的并发连接请求理论可以达到50000个。 
8、nginx配置简洁，正则配置让很多事情变得简单，而且改完配置能使用-t测试配置有没有问题，apache配置复杂，重启的时候发现配置出错了，会很崩溃。 
9、用线程处理用户请求，而线程是共享内存的，只需要开启少量进程，多个线程就可以共享进程的内存，占用内存小。 
10、一个进程死掉时，会影响到多个用户的使用，稳定性差。
11、nginx的设计高度模块化，编写模块相对简单。
12、nginx本身就是一个反向代理服务器，而且可以作为非常优秀的邮件代理服务器。
13、启动特别容易，并且几乎可以做到7*24不间断运行，即使运行数个月也不需要重新启动，还能够不间断服务的情况下进行软件版本的升级。
二:Apache
1、select同步阻塞。
2、一个连接对应一个进程。
3、用进程处理用户请求，用MPM（多处理模块）来绑定到网络端口上，接受请求，调度子进程处理请求。
4、当用户请求过多时，开启的进程较多，占用内存大，每秒最多的并发连接请求最多不超过3000个。
5、一个进程死掉时，不会影响其他的用户
6、apache的rewrite比nginx强大，在rewrite频繁的情况下，用apache。 
7、apache发展到现在，模块超多，基本想到的都可以找到。 
8、apache更为成熟，少bug，nginx的bug相对较多。 
9、apache超稳定。 
10、apache对PHP支持比较简单，nginx需要配合其他后端用。 
11、apache在处理动态请求有优势，一般动态请求要apache去做，nginx适合静态和反向。
12、apache仍然是目前的主流，拥有丰富的特性，成熟的技术和开发社区。
两者核心的区别：
两者最核心的区别在于apache是同步多进程模型，一个连接对应一个进程，而nginx是异步的，多个连接（万级别）可以对应一个进程。一般来说，需要性能的web服务，用nginx。如果不需要性能只求稳定，更考虑apache，apache的各种功能模块实现比nginx好，例如ssl的模块就比nginx好，可配置项多。epoll（freebsd上是kqueue）网络IO模型是nginx处理性能高的根本理由，但并不是所有的情况下都是epoll大获全胜的，如果本身提供静态服务的就只有寥寥几个文件，apache的select模型或许比epoll更高性能
```
#### core down的调试
```
1.首先检查配置core dump设置,看core down调试是否打开
2.ulimit -c unlimited指令进行调试(要对conf文件进行改动)
3.gdb process工具进行调试
4.ulimit -c关闭掉core down
```
[升级版本和回退版本](https://juejin.im/post/5c7c79596fb9a04a054064b5)